@model WaterProj.DTOs.RouteDetailsDto





<div class="container mt-5">

    <div class="container mt-5">
        <!-- Заголовок маршрута -->
        <div class="text-center mb-4">
            <h1 class="display-4 text-primary">Детали маршрута: @Model.Route.Name</h1>
        </div>

        <!-- Карусель изображений -->
        @if (Model.Image != null && Model.Image.Any())
        {
            <div id="routeCarousel" class="carousel slide shadow-lg mb-5" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    @for (int i = 0; i < Model.Image.Count; i++)
                    {
                        <button type="button"
                        data-bs-target="#routeCarousel"
                        data-bs-slide-to="@i"
                        class="@(i == 0 ? "active" : "")"
                        aria-current="@(i == 0 ? "true" : null)"
                        aria-label="Слайд @(i + 1)"></button>
                    }
                </div>

                <div class="carousel-inner">
                    @for (int i = 0; i < Model.Image.Count; i++)
                    {
                        var image = Model.Image[i];
                        <div class="carousel-item @(i == 0 ? "active" : "")">
                            <img src="@image.ImagePath" class="d-block w-100 rounded" alt="Фоточки">
                        </div>
                    }
                </div>

                <button class="carousel-control-prev" type="button" data-bs-target="#routeCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Предыдущий</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#routeCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Следующий</span>
                </button>
            </div>
        }
        else
        {
            <div class="alert alert-warning text-center">
                Нет загруженных изображений для этого маршрута.
            </div>
        }


        <!-- Описание маршрута -->
        <div class="card shadow-lg mb-5">
            <div class="card-body">
                <h3 class="card-title text-primary">
                    <i class="bi bi-info-circle me-2"></i>Описание маршрута
                </h3>
                <p class="card-text" style="white-space: pre-line;">@Model.Route.Description</p>
            </div>
        </div>

        <!-- Блок с минимальной ценой билета -->
        <div class="route-price card mb-4 shadow-lg overflow-hidden">
            <div class="card-body" style="text-align: left !important; padding-left: 15px !important;">
                <div style="display: flex; align-items: center; justify-content: flex-start !important;">
                    <div style="margin-right: 15px; flex-shrink: 0;">
                        <i class="bi bi-currency-exchange text-primary" style="font-size: 2rem;"></i>
                    </div>
                    <div style="text-align: left !important;">
                        <h4 style="margin-bottom: 0 !important; text-align: left !important;">Цена от <span class="text-primary fw-bold">@Model.Route.Price.ToString("N0")</span> рублей</h4>
                        <p style="margin-bottom: 0 !important; text-align: left !important;" class="text-muted">Стоимость указана за одного пассажира, для получения более точной информации свяжитесь с перевозчиком</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Расписание маршрута -->
        <div class="card shadow-lg mb-5">
            <div class="card-body">
                        <h3 class="card-title text-primary">
                            <i class="bi bi-calendar-week me-2"></i>Расписание
                        </h3>

             <!-- Дни недели -->
                @if (Model.Route.RouteDays != null && Model.Route.RouteDays.Any())
                {
                    <div class="mb-3">
                        <div class="days-container">
                            <div class="days-scroll d-inline-flex flex-wrap">
                                @foreach (var day in Model.Route.RouteDays.OrderBy(d => ((int)d.DayOfWeek + 6) % 7))
                                {
                                    <div class="day-badge bg-primary text-white text-center me-1 mb-1 rounded px-2 py-1">
                                        @switch (day.DayOfWeek)
                                        {
                                            case DayOfWeek.Monday:
                                                <text>Пн</text>
                                                break;
                                            case DayOfWeek.Tuesday:
                                                <text>Вт</text>
                                                break;
                                            case DayOfWeek.Wednesday:
                                                <text>Ср</text>
                                                break;
                                            case DayOfWeek.Thursday:
                                                <text>Чт</text>
                                                break;
                                            case DayOfWeek.Friday:
                                                <text>Пт</text>
                                                break;
                                            case DayOfWeek.Saturday:
                                                <text>Сб</text>
                                                break;
                                            case DayOfWeek.Sunday:
                                                <text>Вс</text>
                                                break;
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i> Информация о днях выполнения маршрута отсутствует
                    </div>
                }

                <!-- Описание расписания -->
                <h5 class="text-secondary">Подробное расписание:</h5>
                <p class="card-text" style="white-space: pre-line;">@(string.IsNullOrEmpty(Model.Route.Schedule) ? "Подробное расписание не указано" : Model.Route.Schedule)</p>
            </div>
        </div>


    @await Html.PartialAsync("~/Views/Ship/_ShipDetailsPartial.cshtml", Model)

        <!-- Информация о перевозчике  -->
        @await Html.PartialAsync("~/Views/TransporterAccount/_TransporterInfoPartial.cshtml", Model)


        <!-- Яндекс.Карта -->
        <div class="mb-5">
                <h3 class="text-primary">
                    <i class="bi bi-map me-2"></i>Карта маршрута
                </h3>
            <div id="routeMap" style="width: 100%; height: 400px;" class="rounded shadow-sm"></div>
        </div>


        <!-- Блок действий -->
        @if (User.Identity.IsAuthenticated && User.IsInRole("consumer"))
        {
            ViewBag.RouteId = Model.Route.RouteId;
            @await Html.PartialAsync("~/Views/Order/_CreateOrderPartial.cshtml")
        }
        else if (!User.Identity.IsAuthenticated)
        {
            <div class="alert alert-info text-center mb-5">
                <a asp-controller="Authorization" asp-action="Index" class="text-decoration-none">Войдите</a>, чтобы добавить маршрут в заказы.
            </div>
        }

        <!-- Индикатор популярности маршрута -->
        <div class="route-popularity card mb-4 shadow-lg border-0 rounded-3 overflow-hidden">
            <div class="card-body p-0">
                <div class="d-flex align-items-center">
                    <div class="popularity-icon bg-primary text-white p-4">
                        <i class="bi bi-people-fill" style="font-size: 2.5rem;"></i>
                    </div>
                    <div class="popularity-text p-4">
                        <h4 class="mb-0">Этот маршрут в воспоминаниях у <span class="text-primary fw-bold">@Model.RouteOrderStats</span> пользователей</h4>
                        <p class="mb-0 text-muted">Присоединяйтесь к тем, кто уже приобрел воспоминания о маршруте!</p>
                    </div>
                </div>
            </div>
        </div>


        <!-- Рейтинг и отзывы -->
        <div class="card shadow-lg mb-5">
            <div class="card-body">
                <h3 class="card-title text-primary">
                    </i>Рейтинг и отзывы
                </h3>
                <div class="mb-3">
                    <h4 class="text-warning">
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= Math.Floor(Model.Route.Rating)) // Полные звезды
                            {
                                <i class="bi bi-star-fill"></i>
                            }
                            else if (i == Math.Ceiling(Model.Route.Rating) && Model.Route.Rating % 1 != 0) // Половина звезды
                            {
                                <i class="bi bi-star-half"></i>
                            }
                            else // Пустые звезды
                            {
                                <i class="bi bi-star"></i>
                            }
                        }
                        <span class="text-muted">(@Model.Route.Rating из 5)</span>
                    </h4>
                </div>
                @foreach (var routeRating in Model.RouteRatings)
                {
                    <div class="review mb-3">
                        <div class="d-flex align-items-center">
                            <img src="@routeRating.Consumer.ProfileImagePath" class="rounded-circle me-3" alt="Фото пользователя" style="width: 50px; height: 50px;">
                            <h5 class="mb-0">@routeRating.Consumer.Name</h5>
                        </div>
                        <!-- Рейтинг -->
                        <div class="d-flex align-items-center mb-3 comment-stars">
                            <h5 class="text-warning mb-0 me-2">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= @routeRating.Stars) // Полные звезды
                                    {
                                        <i class="bi bi-star-fill"></i>
                                    }
                                    else // Пустые звезды
                                    {
                                        <i class="bi bi-star"></i>
                                    }
                                }
                            </h5>
                            <span class="text-muted">(@routeRating.Stars из 5)</span>
                        </div>


                        <p class="mt-2">
                            <span class="short-comment" id="short-comment-@routeRating.RouteRatingId">
                                @if (routeRating.Comment.Length > 100)
                                {
                                    @routeRating.Comment.Substring(0, 100)
                                    <a href = "javascript:void(0);" class="text-primary fw-bold" onclick="showFullComment(@routeRating.RouteRatingId)">Посмотреть полностью</a>
                                }
                                else
                                {
                                    @routeRating.Comment
                                    <a href="javascript:void(0);" class="view-more-link text-primary fw-bold" onclick="showFullComment(@routeRating.RouteRatingId)">
                                        Посмотреть полностью
                                    </a>
                                }
                            </span>
                            <span class="full-comment d-none" id="full-comment-@routeRating.RouteRatingId">
                                @routeRating.Comment
                                <a href="javascript:void(0);" class="view-more-link text-primary fw-bold" onclick="hideFullComment(@routeRating.RouteRatingId)">
                                    Скрыть
                                </a>
                            </span>
                        </p>

                        <!-- Дополнительные данные -->
                        <div class="additional-info d-none border rounded p-3 mt-3 shadow-sm" id="additional-info-@routeRating.RouteRatingId">
                            <h6 class="mt-3 text-primary" style="white-space: pre-line;"><i class="bi bi-hand-thumbs-up"></i> Преимущества:</h6>
                            <p class="mt-2 text-muted" style="white-space: pre-line;" >@routeRating.PositiveComments</p>

                            <h6 class="mt-3 text-primary " style="white-space: pre-line;"><i class="bi bi-hand-thumbs-down"></i> Недостатки:</h6>
                            <p class="mt-2 text-muted">@routeRating.NegativeComments</p>

                            <h6 class="mt-3 text-primary"><i class="bi bi-images"></i> Фотографии:</h6>
                            <div class="row">
                                @foreach (var photo in routeRating.ReviewImages)
    {
                                <div class="col-md-3">
                                    <img src="@photo.ImagePath" class="img-fluid rounded shadow-sm mb-2" alt="Фото">
                                </div>
    }
                            </div>
                        </div>

                    </div>
                }

            </div>
        </div>
</div>

    <script>
        function showFullComment(id) {
            document.getElementById(`short-comment-${id}`).classList.add('d-none');
            document.getElementById(`full-comment-${id}`).classList.remove('d-none');
            document.getElementById(`additional-info-${id}`).classList.remove('d-none');
        }

        function hideFullComment(id) {
            document.getElementById(`short-comment-${id}`).classList.remove('d-none');
            document.getElementById(`full-comment-${id}`).classList.add('d-none');
            document.getElementById(`additional-info-${id}`).classList.add('d-none');
        }
    </script>
